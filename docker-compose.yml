services:
  # ============================================
  # Jupyter Lab - Motor Principal Python
  # ============================================
  jupyter:
    build:
      context: ./services/jupyter
      dockerfile: Dockerfile
    container_name: tif-jupyter
    ports:
      - "8888:8888"
    volumes:
      - ./services/jupyter/notebooks:/workspace/notebooks
      - ./shared:/workspace/shared
    environment:
      - JUPYTER_ENABLE_LAB=yes
      - JUPYTER_TOKEN=calculo2025
    command: >
      bash -c "jupyter lab --ip=0.0.0.0 --port=8888 --no-browser --allow-root --NotebookApp.token='calculo2025'"
    networks:
      - calculo-network
    restart: unless-stopped

  # ============================================
  # Streamlit - Dashboard Web Interactivo
  # ============================================
  streamlit:
    build:
      context: ./services/streamlit
      dockerfile: Dockerfile
    container_name: tif-streamlit
    ports:
      - "8501:8501"
    volumes:
      - ./services/streamlit:/app
      - ./shared:/app/shared
    environment:
      - STREAMLIT_SERVER_PORT=8501
      - STREAMLIT_SERVER_ADDRESS=0.0.0.0
    depends_on:
      - jupyter
    networks:
      - calculo-network
    restart: unless-stopped

  # ============================================
  # SageMath - CAS Avanzado
  # ============================================
  sagemath:
    image: sagemath/sagemath:latest
    container_name: tif-sagemath
    ports:
      - "8889:8888"
    volumes:
      - ./shared:/home/sage/shared
      - ./services/sagemath/notebooks:/home/sage/notebooks
      - ./services/sagemath/start-notebook.sh:/home/sage/start-notebook.sh
    command: bash /home/sage/start-notebook.sh
    networks:
      - calculo-network
    restart: unless-stopped

  # ============================================
  # GNU Octave - Computación Numérica
  # ============================================
  octave:
    build:
      context: ./services/octave
      dockerfile: Dockerfile
    container_name: tif-octave
    volumes:
      - ./shared:/workspace
    working_dir: /workspace
    networks:
      - calculo-network
    # Mantener contenedor vivo para ejecutar comandos
    command: tail -f /dev/null
    restart: unless-stopped

# ============================================
# Red compartida entre servicios
# ============================================
networks:
  calculo-network:
    driver: bridge
